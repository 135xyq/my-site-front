(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["message"],{2203:function(t,e,a){"use strict";a("36b8")},"36b8":function(t,e,a){},"3ed3":function(t,e,a){},"4e1d":function(t,e,a){"use strict";a("3ed3")},"8fc4":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"messageContainer",staticClass:"message-container"},[a("MessageComment",{attrs:{title:"留言板",subTitle:"("+t.data.total+")",isListLoading:t.isLoading,list:t.data.rows},on:{submit:t.handleSubmit}}),t.isHasMore?t._e():a("div",{staticClass:"no-more"},[a("Icon",{attrs:{type:"noMore"}}),a("span",[t._v("没有更多了")])],1)],1)},n=[],i=a("ffc2"),r=a("e128"),o=a("0c6d");async function c(t=1,e=10){return await o["a"].get("/api/message",{params:{page:t,limit:e}})}async function l(t){return await o["a"].post("/api/message",t)}var m=a("f119"),u=a("cd6e"),d=a("d010"),f={mixins:[Object(r["a"])({total:0,rows:[]}),Object(m["a"])("messageContainer"),Object(u["a"])()],data(){return{page:1,limit:10}},components:{MessageComment:i["a"],Icon:d["a"]},methods:{async fetchData(){return await c(this.page,this.limit)},async handleSubmit(t,e){const a=await l(t);e("感谢您的留言"),this.data.rows.unshift(a),this.data.total++}}},h=f,p=(a("4e1d"),a("2877")),g=Object(p["a"])(h,s,n,!1,null,"50e7dcae",null);e["default"]=g.exports},9306:function(t,e,a){"use strict";a("ce1e")},cd6e:function(t,e,a){"use strict";e["a"]=function(){return{computed:{isHasMore(){return this.data.rows.length<this.data.total}},created(){this.$bus.$on("mainScroll",this.handleScroll)},destroyed(){this.$bus.$off("mainScroll",this.handleScroll)},methods:{async showMore(){if(!this.isHasMore)return;this.isLoading=!0,this.pager++;const t=await this.fetchData();this.data.total=t.total,this.data.rows=this.data.rows.concat(t.rows),this.isLoading=!1},handleScroll(t){if(this.isLoading||!t)return;const e=100,a=Math.abs(t.scrollTop+t.clientHeight-t.scrollHeight);a<=e&&this.showMore()}}}}},ce1e:function(t,e,a){},e128:function(t,e,a){"use strict";e["a"]=function(t=null){return{data(){return{data:t,isLoading:!0}},async created(){this.data=await this.fetchData(),this.isLoading=!1}}}},e6fa:function(t,e,a){},f119:function(t,e,a){"use strict";e["a"]=function(t){return{mounted(){this.$bus.$on("setMainScroll",this.handlerToTop),this.$refs[t].addEventListener("scroll",this.handlerScroll)},beforeDestroy(){this.$bus.$emit("mainScroll"),this.$refs[t].removeEventListener("scroll",this.handlerScroll),this.$bus.$off("setMainScroll",this.handlerToTop)},methods:{handlerToTop(e){this.$refs[t].scrollTop=e},handlerScroll(){this.$bus.$emit("mainScroll",this.$refs[t])}}}}},f2e5:function(t,e,a){"use strict";e["a"]=function(t,e=!1){const a=new Date(+t),s=a.getFullYear(),n=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,i=a.getDate()<10?"0"+a.getDate():a.getDate();let r=`${s}-${n}-${i}`;if(e){const t=a.getHours().toString().padStart(2,"0"),e=a.getMinutes().toString().padStart(2,"0"),s=a.getSeconds().toString().padStart(2,"0");r+=` ${t}:${e}:${s}`}return r}},ff6b:function(t,e,a){"use strict";a("e6fa")},ffc2:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"message-comment-container"},[a("FormData",t._g({},t.$listeners)),a("h3",[t._v(" "+t._s(t.title)+" "),a("span",[t._v(t._s(t.subTitle))])]),a("CommentsList",{attrs:{list:t.list}}),a("div",{directives:[{name:"vLoading",rawName:"v-vLoading",value:t.isListLoading,expression:"isListLoading"}],staticClass:"loading"})],1)},n=[],i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{ref:"form",staticClass:"from-container",attrs:{id:"form-container"},on:{submit:function(e){return e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[a("div",{staticClass:"nickname"},[a("div",{staticClass:"input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.formDate.nickname,expression:"formDate.nickname"}],attrs:{type:"text",maxlength:"10",placeholder:"请填写昵称"},domProps:{value:t.formDate.nickname},on:{input:function(e){e.target.composing||t.$set(t.formDate,"nickname",e.target.value)}}}),a("span",{staticClass:"tip"},[t._v(t._s(t.formDate.nickname.length+"/10"))])]),a("div",{staticClass:"error"},[t._v(t._s(t.error.nickname))])]),a("div",{staticClass:"nickcontent"},[a("div",{staticClass:"textarea"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formDate.nickcontent,expression:"formDate.nickcontent"}],attrs:{maxlength:"300",placeholder:"请填写内容"},domProps:{value:t.formDate.nickcontent},on:{input:function(e){e.target.composing||t.$set(t.formDate,"nickcontent",e.target.value)}}}),a("span",{staticClass:"tip"},[t._v(t._s(t.formDate.nickcontent.length+"/300"))])]),a("div",{staticClass:"error"},[t._v(t._s(t.error.nickcontent))])]),a("button",{staticClass:"submit",attrs:{disabled:t.isSubmiting}},[t._v(" "+t._s(t.isSubmiting?"提交中":"提交")+" ")])])},r=[],o={data(){return{formDate:{nickname:"",nickcontent:""},error:{nickname:"",nickcontent:""},isSubmiting:!1}},methods:{handleSubmit(){this.error.nickname=this.formDate.nickname.trim()?"":"请填写昵称！",this.error.nickcontent=this.formDate.nickcontent.trim()?"":"请输入要评论内容！",this.error.nickcontent||this.error.nickname||(this.isSubmiting=!0,this.$emit("submit",this.formDate,t=>{this.$showMessage({content:t,duration:1e3,type:"success",container:this.$refs.form,callback:()=>{this.formDate.nickname="",this.formDate.nickcontent="",this.isSubmiting=!1}})}))}}},c=o,l=(a("9306"),a("2877")),m=Object(l["a"])(c,i,r,!1,null,"7b03465a",null),u=m.exports,d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"comment-list"},t._l(t.list,(function(e){return a("li",{key:e.id},[a("Avatar",{attrs:{url:e.avatar,size:44}}),a("div",{staticClass:"data"},[a("div",{staticClass:"name"},[t._v(t._s(e.nickname))]),a("div",{staticClass:"content"},[t._v(t._s(e.content)+" ")]),a("div",{staticClass:"time"},[t._v(t._s(t.formateDate(e.createDate,!0)))])])],1)})),0)},f=[],h=a("77c0"),p=a("f2e5"),g={components:{Avatar:h["a"]},props:{list:{type:Array,default:()=>[]}},methods:{formateDate:p["a"]}},v=g,b=(a("2203"),Object(l["a"])(v,d,f,!1,null,"473b553e",null)),$=b.exports,_={components:{FormData:u,CommentsList:$},props:{title:{type:String,default:""},subTitle:{type:String,default:""},list:{type:Array,default:()=>[]},isListLoading:{type:Boolean,default:!1}}},k=_,D=(a("ff6b"),Object(l["a"])(k,s,n,!1,null,"6588d156",null));e["a"]=D.exports}}]);